<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css" as="style" onload="this.rel='stylesheet';">
<script defer src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("code").forEach((node) => {
      const text = node.innerText;
      if (text.startsWith("$") && text.endsWith("$")) {
        const span = document.createElement("span");
        katex.render(text.slice(1, -1), span);
        node.parentNode.replaceChild(span, node);
      }
    });
    document.querySelectorAll("pre code:not([class])").forEach((node) => {
      const lines = Array.from(node.childNodes).map((item) => item.innerText || "").filter(Boolean);
      if (lines.length >= 2 && lines[0].trim().startsWith("$$") && lines[lines.length - 1].trim().startsWith("$$")) {
        const body = lines.slice(1, -1).join(" ");
        const pre = node.parentNode;
        const p = document.createElement("p");
        katex.render(body, p, { displayMode: true });
        pre.parentNode.replaceChild(p, pre);
      }
    });
  });
</script>
